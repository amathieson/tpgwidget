"use strict";function scrollTo(e,a,t){var n=e.scrollTop,o=a-n,i=0;!function a(){i+=20;var r=Math.easeInOutQuad(i,n,o,t);e.scrollTop=r,i<t&&setTimeout(a,20)}()}var $$=Dom7,stops=[];if("standalone"in window.navigator&&!window.navigator.standalone){var stopName=$$(".center").text();$$.get("/ath.html",function(e){$$("body").html(e),$$("#ath-stop-name").text(stopName)})}else{var genererAutocomplete=function(e,a){f7.autocomplete({openIn:"page",opener:$$(".itineraire-"+e),backOnSelect:!0,source:function(e,a,t){var n=[];if(0!==a.length){for(var o=0;o<stops.length;o++)stops[o].toLowerCase().indexOf(a.toLowerCase())>=0&&n.push(stops[o]);t(n)}else t(stops)},onChange:function(a,t){$$(".itineraire-"+e).find(".item-after").text(t[0]),$$(".itineraire-"+e).find("input").val(t[0])},pageTitle:a,navbarTheme:"white",backText:"Retour",notFoundText:"Aucun arrêt trouvé",searchbarPlaceholderText:"Rechercher…",searchbarCancelText:"Annuler"})},f7=new Framework7({statusbarOverlay:!1,scrollTopOnStatusbarClick:!0,cache:!1,notificationCloseIcon:!1}),mainView=f7.addView(".view-main",{dynamicNavbar:!0});$$.ajax({url:"/ajax/ajaxprochainsdeparts.php?id="+$$(".page-index").attr("data-page").split("-")[1],cache:!1,success:function(e){$$(".page-index .page-content").html(e),$$(".page-index").removeClass("layout-dark")},error:function(){$$(".preloader").addClass("smileyErreur"),$$(".preloader").removeClass("preloader"),$$(".preloader-white").removeClass("preloader-white"),$$(".graym").append("<span>Impossible de se connecter au serveur TPGwidget</span>"),$$(".graym h2").html("Erreur")}}),$$(document).on("ajaxStart",function(e){f7.showPreloader("Chargement...")}),$$(document).on("ajaxComplete",function(){f7.hidePreloader()});var popupHTML="";$$(document).on("click",".open-disruptions",function(){f7.popup(popupHTML)}),$$(document).on("pageBeforeAnimation",function(e){f7.closeNotification(".notifications");var a=e.detail.page.name.split("-");if("infotraffic"==a[0]&&$$(".pull-to-refresh-content").on("refresh",function(e){$$.ajax({url:"/ajax/ajaxperturbations.php",cache:!1,success:function(e){$$("#perturbations-all").html(e),f7.pullToRefreshDone()}})}),"depart"===a[0]){$$(".navbar, .subnavbar").css("background-color","#"+a[1]);var t=$$(".disruptions-data");if(t.length){var n=JSON.parse(t.text()).reduce(function(e,a){return e+'<div class="card">\n                    <div class="card-header">\n                    '+a.nature+'\n                    </div>\n                    <div class="card-content">\n                        <div class="card-content-inner">\n                            '+a.consequence+"\n                        </div>\n                    </div>\n                </div>"},"");popupHTML='<div class="popup popup-perturbations">\n                    <div class="content-block">\n                    '+n+'\n                        <div class="actions-modal-group">\n                            <div class="actions-modal-button color-red close-popup">Fermer</div>\n                        </div>\n                    </div>\n                </div>'}a[2]?($$(".navbar, .subnavbar").addClass("theme-black"),$$(".navbar, .subnavbar").removeClass("theme-white")):($$(".navbar, .subnavbar").removeClass("theme-black"),$$(".navbar, .subnavbar").addClass("theme-white"))}else $$(".navbar, .subnavbar").css("background-color","#f60"),$$(".navbar, .subnavbar").removeClass("theme-black"),$$(".navbar, .subnavbar").addClass("theme-white")}),$$(document).on("pageAfterAnimation",function(e){var a=e.detail.page,t=a.name.split("-");if("depart"===t[0]&&"left"!=a.from){var n=$$(".page-depart .page-content");scrollTo(n[0],Math.min($$(".current").offset().top-88,n[0].scrollHeight-n.height()),500)}"depart"===t[0]&&$$(".disruptions-data").length&&($$(a.container).find(".page-content").css("padding-bottom","150px"),JSON.parse($$(".disruptions-data").text()).forEach(function(e){f7.addNotification({title:e.nature,message:'<a href="#" class="button open-disruptions">En savoir plus</a>'})})),"page"!=t[0]&&"index"!=t[0]||$$.ajax({url:"/ajax/ajaxprochainsdeparts.php?id="+t[1],cache:!1,success:function(e){$$(a.container).find(".page-content").html(e),$$(".page-page").removeClass("layout-dark"),$$(".page-index").removeClass("layout-dark")}})}),$$(document).on("click",".show-m",function(e){$$(".show-h").removeClass("active"),$$(".show-m").addClass("active"),$$(".h").hide(),$$(".m").show()}),$$(document).on("click",".show-h",function(e){$$(".show-m").removeClass("active"),$$(".show-h").addClass("active"),$$(".h").show(),$$(".m").hide()}),f7.onPageInit("itineraire",function(){$$("form.ajax-submit").on("submitted",function(e){mainView.router.load({content:e.detail.data.replace(/SCREENWIDTH/g,screen.width)})}),$$(".heure-depart").on("click",function(){$$(this).addClass("active"),$$(".heure-arrivee").removeClass("active"),$$("#isArrivalTime").val("0")}),$$(".heure-arrivee").on("click",function(){$$(this).addClass("active"),$$(".heure-depart").removeClass("active"),$$("#isArrivalTime").val("1")}),0===stops.length&&$$.ajax({url:"/itineraire/stops.json",method:"GET",dataType:"json",success:function(e){stops=e}}),genererAutocomplete("depart","Départ"),genererAutocomplete("arrivee","Arrivée")}),f7.onPageInit("trajets",function(){new Swiper(".swiper-container",{pagination:".swiper-pagination"})}),f7.onPageInit("arrets",function(){$$.ajax({url:"/arrets/arrets.json",dataType:"json",success:function(e){f7.virtualList(".virtual-list",{items:e,template:'<li><a href="/ajax/page/{{stopCode}}/{{stopName}}" class="item-link"><div class="item-content"><div class="item-inner"><div class="item-title">{{stopName}}</div></div></div></a></li>',searchAll:function(e,a){for(var t=[],n=0;n<a.length;n++)(a[n].stopCode.toLowerCase().indexOf(e.toLowerCase().trim())>=0||a[n].stopName.toLowerCase().indexOf(e.toLowerCase().trim())>=0)&&t.push(n);return t}})}}),"geolocation"in navigator?($$(".location-message").hide(),$$(".enable-geolocation").show(),$$(".enable-geolocation").on("click",function(){$$(".enable-geolocation").hide(),$$(".location-message").css("display","flex"),navigator.geolocation.getCurrentPosition(function(e){$$.ajax({url:"/arrets/geolocation.json",dataType:"json",data:{latitude:e.coords.latitude,longitude:e.coords.longitude},success:function(e){if(0===e.length)$$(".location-message .item-title").text("Aucun arrêt proche trouvé");else{$$(".location-message").hide();for(var a=0;a<e.length;a++){var t=e[a],n='<li><a href="/ajax/page/'+t.stopCode+"/"+t.stopName+'" class="item-link item-content"><div class="item-media"><i class="icon icon-location"></i></div><div class="item-inner"><div class="item-title">'+t.stopName+"</div></div></a></li>";$$(".arrets-location ul").append(n)}}}})},function(){$$(".location-message .item-title").text("Impossible d'obtenir votre position")})})):$$(".arrets-location").remove(),$$("#arrets-search").on("keyup",function(){""!==$$(void 0).val().trim()?$$(".arrets-location").hide():$$(".arrets-location").show()})})}Math.easeInOutQuad=function(e,a,t,n){return(e/=n/2)<1?t/2*e*e+a:(e--,-t/2*(e*(e-2)-1)+a)};