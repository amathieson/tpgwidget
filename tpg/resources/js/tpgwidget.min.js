"use strict";function scrollTo(e,t,a){var i=e.scrollTop,n=t-i,o=0;!function t(){o+=20;var r=Math.easeInOutQuad(o,i,n,a);e.scrollTop=r,o<a&&setTimeout(t,20)}()}var $=Dom7,stops=[];if("standalone"in window.navigator&&!window.navigator.standalone){var stopName=$(".center").text();$.get("/ath.html",function(e){$("body").html(e),$("#ath-stop-name").text(stopName)})}else{var genererAutocomplete=function(e,t){f7.autocomplete({openIn:"page",opener:$(".itineraire-"+e),backOnSelect:!0,source:function(e,t,a){var i=[];if(0!==t.length){for(var n=0;n<stops.length;n++)stops[n].toLowerCase().indexOf(t.toLowerCase())>=0&&i.push(stops[n]);a(i)}else a(stops)},onOpen:function(){$(".autocomplete-page .searchbar-input input").focus()},onChange:function(t,a){$(".itineraire-"+e).find(".item-after").text(a[0]),$(".itineraire-"+e).find("input").val(a[0])},pageTitle:t,navbarTheme:"white",backText:"Retour",notFoundText:"Aucun arrêt trouvé",searchbarPlaceholderText:"Rechercher…",searchbarCancelText:"Annuler",requestSourceOnOpen:!0})},f7=new Framework7({statusbarOverlay:!1,scrollTopOnStatusbarClick:!0,cache:!1}),mainView=f7.addView(".view-main",{dynamicNavbar:!0}),_tempDisruptionsElement=void 0;f7.addDisruption=function(e){if(e){e.place="string"==typeof e.place?"<small>"+e.place+"</small> — ":"",_tempDisruptionsElement||(_tempDisruptionsElement=document.createElement("div"));var t=$(".notifications");0===t.length&&(f7.root.append('<div class="accordion-list notifications list-block media-list"><ul></ul></div>'),t=$(".notifications"));var a=t.children("ul");f7._compiledTemplates.disruption||(f7._compiledTemplates.disruption=Template7.compile('<li class="notification-item notification-hidden accordion-item"><div class="item-content"><div class="item-inner"><div class="item-title-row"><div class="item-title">{{nature}}</div><div class="item-after"><a href="#" class="toggle-disruption"><span></span></a></div></div><div class="accordion-item-content"><p>{{place}}{{consequence}}</p></div></div></div></li>')),_tempDisruptionsElement.innerHTML=f7._compiledTemplates.disruption(e);var i=$(_tempDisruptionsElement).children();i.on("click",function(e){f7.accordionToggle(i)}),a.append(i[0]),t.show();var n=i.outerHeight();return i.transform("translate3d(0,"+-n+"px,0)"),i.transition(0),i[0].clientLeft,i.transition(""),i.transform("translate3d(0,0px,0)"),t.transform("translate3d(0, 0,0)"),i.removeClass("notification-hidden"),i[0]}},$.ajax({url:"/ajax/ajaxprochainsdeparts.php?id="+$(".page-index").attr("data-page").split("-")[1],cache:!1,success:function(e){$(".page-index .page-content").html(e),$(".page-index").removeClass("layout-dark")},error:function(){$(".preloader").addClass("smileyErreur"),$(".preloader").removeClass("preloader"),$(".preloader-white").removeClass("preloader-white"),$(".graym").append("<span>Impossible de se connecter au serveur TPGwidget</span>"),$(".graym h2").html("Erreur")}}),$(document).on("ajaxStart",function(e){f7.showPreloader("Chargement...")}),$(document).on("ajaxComplete",function(){f7.hidePreloader(),$(".modal-overlay").removeClass("modal-overlay-visible")}),$(document).on("pageBeforeAnimation",function(e){f7.closeNotification(".notifications");var t=e.detail.page.name.split("-");"infotraffic"===t[0]&&$(".pull-to-refresh-content").on("refresh",function(e){$.ajax({url:"/ajax/ajaxperturbations.php",cache:!1,success:function(e){$("#perturbations-all").html(e),f7.pullToRefreshDone()}})});var a=$(".navbar, .subnavbar");if("depart"===t[0]){a.css("background-color",t[1]);t[2]?(a.addClass("theme-black"),a.removeClass("theme-white")):(a.removeClass("theme-black"),a.addClass("theme-white"))}else a.css("background-color","#fb6400"),a.removeClass("theme-black"),a.addClass("theme-white")}),$(document).on("pageAfterAnimation",function(e){var t=e.detail.page,a=t.name.split("-");if("depart"===a[0]&&"left"!=t.from){var i=$(".page-depart .page-content");scrollTo(i[0],Math.min($(".current").offset().top-88,i[0].scrollHeight-i.height()),500)}if("depart"===a[0]&&$(".disruptions-data").length){$(t.container).find(".page-content").css("padding-bottom","150px");JSON.parse($(".disruptions-data").text()).forEach(function(e,t){f7.addDisruption(e)}),f7.accordionOpen($(".notification-item:first-child"))}"page"!=a[0]&&"index"!=a[0]||$.ajax({url:"/ajax/ajaxprochainsdeparts.php?id="+a[1],cache:!1,success:function(e){$(t.container).find(".page-content").html(e),$(".page-page").removeClass("layout-dark"),$(".page-index").removeClass("layout-dark")}})}),$(document).on("click",".show-m",function(e){$(".show-h").removeClass("active"),$(".show-m").addClass("active"),$(".h").hide(),$(".m").show()}),$(document).on("click",".show-h",function(e){$(".show-m").removeClass("active"),$(".show-h").addClass("active"),$(".h").show(),$(".m").hide()}),f7.onPageInit("itineraire",function(){$("form.ajax-submit").on("submitted",function(e){mainView.router.load({content:e.detail.data.replace(/SCREENWIDTH/g,screen.width)})}),$(".itineraire-invert").on("click",function(){var e=$('input[name="depart"]').val(),t=$('input[name="arrivee"]').val();$('input[name="depart"]').val(t),$(".itineraire-depart .item-after").text(""!==t?t:"Cliquez pour choisir"),$('input[name="arrivee"]').val(e),$(".itineraire-arrivee .item-after").text(""!==e?e:"Cliquez pour choisir")}),$(".heure-depart").on("click",function(){$(this).addClass("active"),$(".heure-arrivee").removeClass("active"),$("#isArrivalTime").val("0")}),$(".heure-arrivee").on("click",function(){$(this).addClass("active"),$(".heure-depart").removeClass("active"),$("#isArrivalTime").val("1")}),0===stops.length&&$.ajax({url:"/itineraire/stops.json",method:"GET",dataType:"json",success:function(e){stops=e}}),genererAutocomplete("depart","Départ"),genererAutocomplete("arrivee","Arrivée")}),f7.onPageInit("trajets",function(){new Swiper(".swiper-container",{pagination:".swiper-pagination"})}),f7.onPageInit("arrets",function(){$.ajax({url:"/arrets/arrets.json",dataType:"json",success:function(e){var t=function(e){return e=e.toLowerCase(),e=e.replace(/[éèê]/g,"e"),e=e.replace(/[àâ]/g,"a"),e=e.replace(/[îï]/g,"i"),e=e.replace(/[ûù]/g,"u"),e=e.replace(/[ôö]/g,"o"),e=e.replace(/'/g,"’"),(e=e.replace(/[ \.\(\)\+-]/g,"")).trim()};f7.virtualList(".virtual-list",{items:e,template:'<li><a href="/ajax/page/{{stopCode}}/{{stopNameOriginal}}" class="item-link"><div class="item-content"><div class="item-inner"><div class="item-title">{{stopNameDisplay}}</div></div></div></a></li>',searchAll:function(e,a){return e=t(e),Object.keys(a).filter(function(i){var n=a[i];return t(n.stopNameRaw).includes(e)||t(n.stopCode).includes(e)||t(n.stopNameOriginal).includes(e)})}})}}),"geolocation"in navigator?($(".location-message").hide(),$(".enable-geolocation").show(),$(".enable-geolocation").on("click",function(){$(".enable-geolocation").hide(),$(".location-message").css("display","flex"),navigator.geolocation.getCurrentPosition(function(e){$.ajax({url:"/arrets/geolocation.json",dataType:"json",data:{latitude:e.coords.latitude,longitude:e.coords.longitude},success:function(e){if(0===e.length)$(".location-message .item-title").text("Aucun arrêt proche trouvé");else{$(".location-message").hide();for(var t=0;t<e.length;t++){var a=e[t],i='<li><a href="/ajax/page/'+a.stopCode+"/"+a.stopNameOriginal+'" class="item-link item-content"><div class="item-media"><i class="icon icon-location"></i></div><div class="item-inner"><div class="item-title">'+a.stopNameDisplay+"</div></div></a></li>";$(".arrets-location ul").append(i)}}}})},function(){$(".location-message .item-title").text("Impossible d'obtenir votre position")})})):$(".arrets-location").remove(),$("#arrets-search").on("keyup",function(){""!==$(this).val().trim()?$(".arrets-location").hide():$(".arrets-location").show()})})}Math.easeInOutQuad=function(e,t,a,i){return(e/=i/2)<1?a/2*e*e+t:(e--,-a/2*(e*(e-2)-1)+t)};